DROP TABLE produkty CASCADE;
DROP TABLE kraje CASCADE;
DROP TABLE producenci CASCADE;
DROP TABLE kategorie CASCADE;
DROP TABLE typy CASCADE;
DROP TABLE sklad_produktow CASCADE;
DROP TABLE skladniki CASCADE;
DROP TABLE uzytkownicy CASCADE;
DROP TABLE rodzaj_konta CASCADE;
DROP TABLE adresy CASCADE;
DROP TABLE koszyki_klientow CASCADE;
DROP TABLE zamowienia CASCADE;
DROP TABLE zamowione_produkty CASCADE;

CREATE TABLE kraje (
    kraj VARCHAR(100) PRIMARY KEY
);

CREATE TABLE producenci (
    producent VARCHAR(100) PRIMARY KEY
);

CREATE TABLE typy (
	typ VARCHAR(100) PRIMARY KEY
);

CREATE TABLE kategorie (
    kategoria VARCHAR(100) PRIMARY KEY,
	typ VARCHAR(100) NOT NULL REFERENCES typy(typ) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE produkty (
    id_produktu INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nazwa_produktu VARCHAR(100) UNIQUE NOT NULL,
    kraj VARCHAR(100) NOT NULL REFERENCES kraje(kraj) ON UPDATE CASCADE ON DELETE RESTRICT,
	producent VARCHAR(100) REFERENCES producenci(producent) ON UPDATE CASCADE ON DELETE RESTRICT,
	kategoria VARCHAR(100) NOT NULL REFERENCES kategorie(kategoria) ON UPDATE CASCADE ON DELETE RESTRICT,
	dostepnosc INTEGER NOT NULL CHECK(dostepnosc>=0),
	cena_za_100g FLOAT NOT NULL,
	promocja INTEGER CHECK(0 <= promocja AND promocja <= 99)
);

CREATE TABLE skladniki (
	skladnik VARCHAR (100) PRIMARY KEY
);

CREATE TABLE sklad_produktow (
	id_produktu INTEGER NOT NULL REFERENCES produkty(id_produktu) ON UPDATE CASCADE ON DELETE CASCADE,
	skladnik VARCHAR (100) NOT NULL REFERENCES skladniki(skladnik) ON UPDATE CASCADE ON DELETE RESTRICT,
	PRIMARY KEY(id_produktu, skladnik)
);

CREATE TABLE rodzaj_konta (
	rodzaj_konta VARCHAR(100) PRIMARY KEY
);

CREATE TABLE uzytkownicy (
	id_uzytkownika INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	nazwisko VARCHAR(100) NOT NULL,
	imie VARCHAR(100) NOT NULL,
	e_mail VARCHAR(100) UNIQUE NOT NULL,
	haslo VARCHAR(100) NOT NULL,
	rodzaj_konta VARCHAR(100) NOT NULL REFERENCES rodzaj_konta(rodzaj_konta) ON UPDATE CASCADE ON DELETE RESTRICT
);

CREATE TABLE adresy (
	id_adresu INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	id_uzytkownika INTEGER NOT NULL REFERENCES uzytkownicy(id_uzytkownika) ON UPDATE CASCADE ON DELETE RESTRICT,
	miasto VARCHAR(100) NOT NULL,
	kod_pocztowy VARCHAR(6) NOT NULL CHECK (kod_pocztowy ~ '^[0-9]{2}-[0-9]{3}$'),
	ulica VARCHAR(100) not NULL,
	nr_domu INTEGER NOT NULL,
	nr_mieszkania INTEGER not NULL,
	UNIQUE(id_uzytkownika, miasto, kod_pocztowy, ulica, nr_domu, nr_mieszkania)
);
	
CREATE TABLE koszyki_klientow (
	id_uzytkownika INTEGER NOT NULL REFERENCES uzytkownicy(id_uzytkownika) ON UPDATE CASCADE ON DELETE CASCADE,
	id_produktu INTEGER NOT NULL REFERENCES produkty(id_produktu) ON UPDATE CASCADE ON DELETE CASCADE,
	ilosc INTEGER NOT NULL,
	cena DOUBLE PRECISION,
	PRIMARY KEY(id_uzytkownika, id_produktu)
);

CREATE TABLE zamowienia (
	id_zamowienia INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	id_uzytkownika INTEGER NOT NULL REFERENCES uzytkownicy(id_uzytkownika) ON UPDATE CASCADE ON DELETE RESTRICT,
	data_zamowienia DATE NOT null,
	id_adresu INTEGER NOT NULL REFERENCES adresy(id_adresu) ON UPDATE CASCADE ON DELETE RESTRICT
	kwota DOUBLE PRECISION,
);

CREATE TABLE zamowione_produkty (
	id_zamowienia INTEGER NOT NULL REFERENCES zamowienia(id_zamowienia) ON UPDATE CASCADE ON DELETE CASCADE,
	id_produktu INTEGER NOT NULL REFERENCES produkty(id_produktu) ON UPDATE CASCADE ON DELETE RESTRICT,
	ilosc INTEGER NOT NULL,
	cena DOUBLE PRECISION,
	PRIMARY KEY(id_zamowienia, id_produktu)
);

INSERT INTO typy(typ) VALUES ('herbata');
INSERT INTO typy(typ) VALUES ('kawa');
INSERT INTO typy(typ) VALUES ('akcesoria');

INSERT INTO rodzaj_konta (rodzaj_konta) VALUES ('admin');
INSERT INTO rodzaj_konta (rodzaj_konta) VALUES ('user');

INSERT INTO uzytkownicy (imie, nazwisko, e_mail, haslo, rodzaj_konta) VALUES ('Aleksy', 'Abacki', 'albacki@gmail.com', 'albacki', 'admin');
INSERT INTO uzytkownicy (imie, nazwisko, e_mail, haslo, rodzaj_konta) VALUES ('Bartek', 'Bartecki', 'babartecki@gmail.com', 'teczowemisiaczki', 'user');
INSERT INTO uzytkownicy (imie, nazwisko, e_mail, haslo, rodzaj_konta) VALUES ('Celina', 'Cerniak', 'cornacela@gmail.com', 'y4stytucyo4alyzm', 'user');
INSERT INTO uzytkownicy (imie, nazwisko, e_mail, haslo, rodzaj_konta) VALUES ('Daniel', 'Darwin', 'danewolucyjny@gmail.com', 'mojkochanypiesDariusz',  'user');
INSERT INTO uzytkownicy (imie, nazwisko, e_mail, haslo, rodzaj_konta) VALUES ('Ewa', 'Emil', 'ewemilia@mail.com', 'nielubieswojegonazwiska', 'user');
INSERT INTO uzytkownicy (imie, nazwisko, e_mail, haslo, rodzaj_konta) VALUES ('Adam',  'Adminski', 'admin@gmail.com', 'admin', 'admin');

INSERT INTO adresy (id_uzytkownika, miasto, kod_pocztowy, ulica, nr_domu, nr_mieszkania) VALUES (1, 'Wroclaw', '01-411', 'wroclawska', 1, 2);
INSERT INTO adresy (id_uzytkownika, miasto, kod_pocztowy, ulica, nr_domu, nr_mieszkania) VALUES (2, 'Wroclaw', '01-413', 'niewroclawska', 3, 4);
INSERT INTO adresy (id_uzytkownika, miasto, kod_pocztowy, ulica, nr_domu, nr_mieszkania) VALUES (1, 'Warszawa', '02-221', 'krucza', 6, 18);
INSERT INTO adresy (id_uzytkownika, miasto, kod_pocztowy, ulica, nr_domu, nr_mieszkania) VALUES (3, 'Krakow', '03-412', 'zamkowa', 18, 6);
INSERT INTO adresy (id_uzytkownika, miasto, kod_pocztowy, ulica, nr_domu, nr_mieszkania) VALUES (4, 'Urwiskowo Gorne', '31-001', 'Urwiskowo Gorne', 1, 1);
INSERT INTO adresy (id_uzytkownika, miasto, kod_pocztowy, ulica, nr_domu, nr_mieszkania) VALUES (5, 'zagan', '14-159', 'zielona', 9, 7);

INSERT INTO kraje(kraj) VALUES ('Chiny');
INSERT INTO kraje(kraj) VALUES ('Indie');
INSERT INTO kraje(kraj) VALUES ('Tajwan');

INSERT INTO producenci(producent) VALUES ('Jiu Keng Quntizhong');
INSERT INTO producenci(producent) VALUES ('yabukita');
INSERT INTO producenci(producent) VALUES ('qingxin ganzai');

INSERT INTO kategorie(typ, kategoria) VALUES ('herbata', 'herbata czarna');
INSERT INTO kategorie(typ, kategoria) VALUES ('herbata', 'herbata zielona');
INSERT INTO kategorie(typ, kategoria) VALUES ('herbata', 'herbata zolta');
INSERT INTO kategorie(typ, kategoria) VALUES ('herbata', 'herbata biala');
INSERT INTO kategorie(typ, kategoria) VALUES ('herbata', 'pu erh');
INSERT INTO kategorie(typ, kategoria) VALUES ('herbata', 'yerba mate');
INSERT INTO kategorie(typ, kategoria) VALUES ('herbata', 'herbata czarna z dodatkami');
INSERT INTO kategorie(typ, kategoria) VALUES ('herbata', 'herbata zielona z dodatkami');
INSERT INTO kategorie(typ, kategoria) VALUES ('herbata', 'herbata zolta z dodatkami');
INSERT INTO kategorie(typ, kategoria) VALUES ('herbata', 'herbata biala z dodatkami');
INSERT INTO kategorie(typ, kategoria) VALUES ('herbata', 'pu erh z dodatkami');

INSERT INTO skladniki(skladnik) VALUES ('aloes');
INSERT INTO skladniki(skladnik) VALUES ('ananas');
INSERT INTO skladniki(skladnik) VALUES ('cytryna');
INSERT INTO skladniki(skladnik) VALUES ('jasmin');
INSERT INTO skladniki(skladnik) VALUES ('morela');
INSERT INTO skladniki(skladnik) VALUES ('nagietek');
INSERT INTO skladniki(skladnik) VALUES ('werbena cytrynowa');

INSERT INTO produkty (nazwa_produktu, producent, kraj, kategoria, cena_za_100g, promocja, dostepnosc) VALUES ('Long Jing Supergrade', 'Jiu Keng Quntizhong', 'Chiny', 'herbata zielona', 119, 0, 5000);
INSERT INTO produkty (nazwa_produktu, producent, kraj, kategoria, cena_za_100g, promocja, dostepnosc) VALUES ('Darjeeling Rohini Yabukita', 'yabukita', 'Indie', 'herbata czarna', 52, 0, 10000);
INSERT INTO produkty (nazwa_produktu, producent, kraj, kategoria, cena_za_100g, promocja, dostepnosc) VALUES ('Sanxia Yefang Huangcha', 'qingxin ganzai', 'Tajwan', 'herbata zolta', 459, 10, 500);
INSERT INTO produkty (nazwa_produktu, kraj, kategoria, cena_za_100g, promocja, dostepnosc) VALUES ('Moc Aloesu Wellness', 'Chiny', 'herbata zielona z dodatkami', 459, 10, 500);
